<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayer Times</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        #location-info {
            font-size: 16px;
            margin-bottom: 20px;
            color: #00796b;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        table, th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #00796b;
            color: #fff;
        }

        td {
            background-color: #fff;
        }

        .prayer-time-row {
            background-color: #f8f8f8;
        }

        .current-prayer {
            background-color: #ffeb3b;
            color: #000;
            font-weight: bold;
        }

        #date-info {
            margin-top: 20px;
            font-size: 16px;
            color: #00796b;
            padding: 15px;
            border: 2px solid #00796b;
            background-color: #e0f2f1;
            border-radius: 5px;
        }

        .method-select {
            margin: 20px 0;
        }

        #method-select {
            font-size: 16px;
            padding: 8px;
            margin: 20px 0;
            border: 2px solid #00796b;
            border-radius: 5px;
            background-color: #ffffff;
            color: #00796b;
            cursor: pointer;
            width: auto;
            max-width: 250px;
            word-wrap: break-word;
            white-space: normal;
        }

        #method-select option {
            word-wrap: break-word;
        }

        #method-select:focus {
            outline: none;
            border-color: #004d40;
        }

        .prayer-time-row:hover {
            background-color: #c8e6c9;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="location-info">Fetching your location...</div>
    
    <!-- Method Selection Dropdown -->
    <div class="method-select">
        <label for="method-select">Select Calculation Method:</label>
        <select id="method-select" onchange="getPrayerTimes()">
            <option value="0">Jafari / Shia Ithna-Ashari</option>
            <option value="1">University of Islamic Sciences, Karachi</option>
            <option value="2">Islamic Society of North America</option>
            <option value="3">Muslim World League</option>
            <option value="4">Umm Al-Qura University, Makkah</option>
            <option value="5">Egyptian General Authority of Survey</option>
            <option value="7">Institute of Geophysics, University of Tehran</option>
            <option value="8">Gulf Region</option>
            <option value="9">Kuwait</option>
            <option value="10">Qatar</option>
            <option value="12">Majlis Ugama Islam Singapura, Singapore</option>
            <option value="12">Union Organization Islamic de France</option>
            <option value="13">Diyanet İşleri Başkanlığı, Turkey</option>
            <option value="14">Spiritual Administration of Muslims of Russia</option>
            <option value="15">Moonsighting Committee Worldwide (requires Shafaq parameter)</option>
            <option value="16">Dubai (experimental)</option>
            <option value="17">Jabatan Kemajuan Islam Malaysia (JAKIM)</option>
            <option value="18">Tunisia</option>
            <option value="19">Algeria</option>
            <option value="20">KEMENAG - Kementerian Agama Republik Indonesia</option>
            <option value="21">Morocco</option>
            <option value="22">Comunidade Islamica de Lisboa</option>
            <option value="23">Ministry of Awqaf, Islamic Affairs and Holy Places, Jordan</option>
        </select>
    </div>

    <div id="date-info"></div>

    <div id="prayer-times">
        <h2>Prayer Times:</h2>
        <table>
            <thead>
                <tr>
                    <th>Prayer</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody id="times-list">
                <!-- Prayer times will be inserted here -->
            </tbody>
        </table>
    </div>

    <script>
        // Automatically fetch prayer times when the page loads
        window.onload = function() {
            getPrayerTimes();
        };

        function getPrayerTimes() {
            // Get the selected method from the dropdown
            const method = document.getElementById("method-select").value;

            // Check if geolocation is available
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    const date = new Date().toISOString().split('T')[0].split('-').reverse().join('-'); // Current date in DD-MM-YYYY format

                    // Display location info
                    const geocodeUrl = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`;
                    fetch(geocodeUrl)
                        .then(response => response.json())
                        .then(locationData => {
                            const address = locationData.locality || 'Address not available';
                            document.getElementById('location-info').innerHTML = `Your Location: ${address}, Latitude: ${latitude.toFixed(2)}, Longitude: ${longitude.toFixed(2)}`;

                            // Get prayer times using the latitude and longitude
                            const prayerTimesUrl = `https://api.aladhan.com/v1/timings/${date}?latitude=${latitude}&longitude=${longitude}&method=${method}`;

                            fetch(prayerTimesUrl)
                                .then(response => response.json())
                                .then(data => {
                                    if (data.code === 200) {
                                        const timings = data.data.timings;
                                        const dateData = data.data.date;
                                        displayDateInfo(dateData);
                                        displayPrayerTimes(timings);
                                    } else {
                                        alert('Error fetching prayer times. Please try again.');
                                    }
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    alert('An error occurred. Please try again.');
                                });
                        });
                }, function(error) {
                    alert('Error fetching location. Please enable location services.');
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }

        function displayDateInfo(dateData) {
            const gregorianDate = dateData.gregorian;
            const hijriDate = dateData.hijri;

            const gregorianDateStr = `${gregorianDate.day} ${gregorianDate.month.en} ${gregorianDate.year} (${gregorianDate.weekday.en})`;
            const hijriDateStr = `${hijriDate.day} ${hijriDate.month.en} ${hijriDate.year} (${hijriDate.weekday.en})`;
            const hijriDateAr = `${hijriDate.day} ${hijriDate.month.ar} ${hijriDate.year} (${hijriDate.weekday.ar})`;

            let holidays = hijriDate.holidays.length > 0 ? `<br>Holidays: ${hijriDate.holidays.join(', ')}` : '';

            document.getElementById('date-info').innerHTML = `
                <strong>${gregorianDateStr}</strong>
           <br>
           <strong></strong> ${hijriDateStr}
                
                <br>
                ${hijriDateAr}<br>
                ${holidays}
            `;
        }

        function displayPrayerTimes(timings) {
            const timesList = document.getElementById('times-list');
            timesList.innerHTML = '';

            const currentTime = new Date().toLocaleTimeString('en-US', { hour12: false }).slice(0, 5); // Current time in HH:MM format
            let currentPrayer = null;

            for (let prayer in timings) {
                if (timings.hasOwnProperty(prayer)) {
                    const row = document.createElement('tr');
                    row.classList.add('prayer-time-row');
                    
                    const prayerTime = timings[prayer];
                    const prayerRow = `<td>${prayer}</td><td>${prayerTime}</td>`;
                    row.innerHTML = prayerRow;

                    // Check if current prayer time is ongoing
                    if (isCurrentPrayer(currentTime, prayerTime)) {
                        row.classList.add('current-prayer');
                        currentPrayer = prayer;
                    }

                    timesList.appendChild(row);
                }
            }

            document.getElementById('prayer-times').style.display = 'block';
        }

        function isCurrentPrayer(currentTime, prayerTime) {
            const [currentHour, currentMinute] = currentTime.split(':').map(Number);
            const [prayerHour, prayerMinute] = prayerTime.split(':').map(Number);

            if (currentHour === prayerHour && currentMinute === prayerMinute) {
                return true;
            }
            return false;
        }
    </script>

</body>
</html>
