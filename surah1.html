<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quran Verse Generator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; color: #333; }
    h1 { text-align: center; }
    .form-container { max-width: 500px; margin: 0 auto; padding: 15px; background: #fff; border-radius: 8px; }
    .form-container label { display: block; margin: 10px 0 5px; }
    .form-container select, .form-container input { width: 100%; padding: 8px; margin-bottom: 10px; }
    #generate-btn, #generate-video-btn { width: 100%; padding: 10px; background: #007BFF; color: #fff; border: none; cursor: pointer; }
    #result { max-width: 800px; margin: 0 auto; }
    .verse { background: #fff; margin: 10px 0; padding: 15px; border-radius: 6px; }
    .verse .arabic { font-size: 20px; text-align: right; direction: rtl; }
    .verse .english { font-size: 16px; text-align: left; }
    .verse audio { width: 100%; }
    .error { color: red; text-align: center; }
  </style>
</head>
<body>
  <h1>Quran Verse Generator</h1>
  <div class="form-container">
    <label for="surah-select">Select Surah:</label>
    <select id="surah-select"><option value="">Loading surahs...</option></select>
    <label for="start-verse">Start Verse:</label>
    <input type="number" id="start-verse" min="1" placeholder="e.g., 1">
    <label for="end-verse">End Verse:</label>
    <input type="number" id="end-verse" min="1" placeholder="e.g., 6">
    <button id="generate-btn">Generate</button>
    <button id="generate-video-btn" disabled>Generate Video</button>
    <div id="error-message" class="error"></div>
  </div>
  <div id="result"></div>
  <script>
    let audioUrls = [];
    document.getElementById('generate-btn').addEventListener('click', () => {
      const surah = document.getElementById('surah-select').value;
      const start = parseInt(document.getElementById('start-verse').value);
      const end = parseInt(document.getElementById('end-verse').value);
      if (!surah || isNaN(start) || isNaN(end) || start > end) {
        document.getElementById('error-message').textContent = 'Invalid input';
        return;
      }
      fetch(`https://api.alquran.cloud/v1/surah/${surah}/ar.alafasy`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('result').innerHTML = '';
          audioUrls = [];
          data.data.ayahs.slice(start - 1, end).forEach(ayah => {
            let div = document.createElement('div');
            div.className = 'verse';
            div.innerHTML = `<audio controls src="${ayah.audio}"></audio>
                             <p class='arabic'>${ayah.text}</p>`;
            document.getElementById('result').appendChild(div);
            audioUrls.push(ayah.audio);
          });
          document.getElementById('generate-video-btn').disabled = false;
        });
    });
    document.getElementById('generate-video-btn').addEventListener('click', () => {
      let link = document.createElement('a');
      link.href = `https://quran-online.pages.dev/surah1?audios=${audioUrls.join(',')}`;
      link.download = 'quran_video.mp4';
      link.click();
    });
        const surahSelect = document.getElementById('surah-select');
    const generateBtn = document.getElementById('generate-btn');
    const resultDiv = document.getElementById('result');
    const errorDiv = document.getElementById('error-message');

    let surahsList = [];

    // Fetch surah list on page load
    fetch('https://api.alquran.cloud/v1/surah')
      .then(response => response.json())
      .then(data => {
        surahsList = data.data; // Array of surah objects
        populateSurahDropdown(surahsList);
      })
      .catch(error => {
        surahSelect.innerHTML = `<option value="">Error loading surahs</option>`;
        console.error('Error fetching surah list:', error);
      });

    // Populate the dropdown with surah options
    function populateSurahDropdown(surahs) {
      surahSelect.innerHTML = '<option value="">-- Select Surah --</option>';
      surahs.forEach(surah => {
        const option = document.createElement('option');
        option.value = surah.number;
        // Storing number of ayahs as a data attribute for range validation
        option.setAttribute('data-ayahs', surah.numberOfAyahs);
        option.textContent = `${surah.number}. ${surah.englishName} (${surah.name})`;
        surahSelect.appendChild(option);
      });
    }

    // Handle Generate button click
    generateBtn.addEventListener('click', () => {
      errorDiv.textContent = '';
      resultDiv.innerHTML = '';

      const surahNumber = surahSelect.value;
      const startVerse = parseInt(document.getElementById('start-verse').value);
      const endVerse = parseInt(document.getElementById('end-verse').value);

      if (!surahNumber) {
        errorDiv.textContent = 'Please select a surah.';
        return;
      }
      if (isNaN(startVerse) || isNaN(endVerse)) {
        errorDiv.textContent = 'Please enter valid verse numbers.';
        return;
      }
      if (startVerse < 1 || endVerse < startVerse) {
        errorDiv.textContent = 'Invalid verse range.';
        return;
      }

      // Validate verse range against total ayahs from selected surah
      const selectedOption = surahSelect.options[surahSelect.selectedIndex];
      const totalAyahs = parseInt(selectedOption.getAttribute('data-ayahs'));
      if (endVerse > totalAyahs) {
        errorDiv.textContent = `This surah has only ${totalAyahs} verses.`;
        return;
      }

      // API endpoints for Arabic and English
      const arabicURL = `https://api.alquran.cloud/v1/surah/${surahNumber}/ar.alafasy`;
      const englishURL = `https://api.alquran.cloud/v1/surah/${surahNumber}/en.ahmedraza`;

      // Show loading message
      resultDiv.innerHTML = '<p>Loading verses...</p>';

      // Fetch both Arabic and English data concurrently
      Promise.all([
        fetch(arabicURL).then(res => res.json()),
        fetch(englishURL).then(res => res.json())
      ])
      .then(([arabicData, englishData]) => {
        // Filter ayahs within selected range
        const arabicAyahs = arabicData.data.ayahs.filter(ayah => ayah.numberInSurah >= startVerse && ayah.numberInSurah <= endVerse);
        const englishAyahs = englishData.data.ayahs.filter(ayah => ayah.numberInSurah >= startVerse && ayah.numberInSurah <= endVerse);

        // Clear loading message
        resultDiv.innerHTML = '';

        // Display each verse with audio, Arabic text, and English translation
        for (let i = 0; i < arabicAyahs.length; i++) {
          const verseDiv = document.createElement('div');
          verseDiv.className = 'verse';

          // Audio element using Arabic audio URL
          const audioEl = document.createElement('audio');
          audioEl.controls = true;
          const sourceEl = document.createElement('source');
          sourceEl.src = arabicAyahs[i].audio;
          sourceEl.type = 'audio/mpeg';
          audioEl.appendChild(sourceEl);
          verseDiv.appendChild(audioEl);

          // Arabic text paragraph
          const arabicP = document.createElement('p');
          arabicP.className = 'arabic';
          arabicP.textContent = arabicAyahs[i].text;
          verseDiv.appendChild(arabicP);

          // English text paragraph
          const englishP = document.createElement('p');
          englishP.className = 'english';
          englishP.textContent = englishAyahs[i] ? englishAyahs[i].text : '';
          verseDiv.appendChild(englishP);

          resultDiv.appendChild(verseDiv);
        }
      })
      .catch(error => {
        console.error('Error fetching verses:', error);
        resultDiv.innerHTML = '<p class="error">An error occurred while fetching verses.</p>';
      });
    });
  </script>
</body>
</html>
