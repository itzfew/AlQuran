<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>القرآن الكريم - Quran Kareem</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;600&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c5e8f;
            --secondary-color: #3a7cb9;
            --accent-color: #f0c14b;
            --text-color: #333;
            --light-text: #777;
            --bg-color: #f9f5f0;
            --card-bg: #fff;
            --border-color: #e1e1e1;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --dark-primary: #1e3a8a;
            --dark-secondary: #1e40af;
            --dark-text: #f3f4f6;
            --dark-bg: #111827;
            --dark-card: #1f2937;
            --dark-border: #374151;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Amiri', 'Scheherazade New', serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            line-height: 1.6;
            font-size: 18px;
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .app-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .dark-mode .app-header {
            background-color: var(--dark-primary);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Cairo', sans-serif;
        }

        /* Surah Header */
        .surah-header {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            box-shadow: var(--shadow);
            position: relative;
            border-bottom: 4px solid var(--primary-color);
        }

        .dark-mode .surah-header {
            background-color: var(--dark-card);
            border-bottom-color: var(--dark-secondary);
        }

        .surah-name {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .dark-mode .surah-name {
            color: var(--dark-secondary);
        }

        .surah-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            color: var(--light-text);
            font-size: 0.9rem;
        }

        .dark-mode .surah-info {
            color: #9ca3af;
        }

        /* Verse Styles */
        .verse-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .dark-mode .verse-container {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .verse-container.selected {
            border-left: 4px solid var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        .verse-number {
            background-color: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            margin-left: 10px;
            vertical-align: middle;
        }

        .dark-mode .verse-number {
            background-color: var(--dark-secondary);
        }

        .arabic-text {
            font-size: 1.8rem;
            line-height: 2.5;
            text-align: right;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .translation-text, .urdu-text {
            font-size: 1rem;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
            font-family: 'Cairo', sans-serif;
        }

        .dark-mode .translation-text, 
        .dark-mode .urdu-text {
            border-bottom-color: var(--dark-border);
        }

        .urdu-text {
            font-family: 'Amiri', serif;
            font-size: 1.1rem;
            color: var(--light-text);
        }

        .dark-mode .urdu-text {
            color: #d1d5db;
        }

        /* Action Buttons */
        .verse-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .verse-container:hover .verse-actions,
        .verse-container.selected .verse-actions {
            opacity: 1;
        }

        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s ease;
        }

        .share-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .dark-mode .share-btn {
            background-color: var(--dark-secondary);
        }

        .view-btn {
            background-color: var(--accent-color);
            color: #333;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Navigation Controls */
        .nav-controls {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
        }

        .nav-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .dark-mode .nav-btn {
            background-color: var(--dark-primary);
        }

        .nav-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .dark-mode .nav-btn:hover {
            background-color: var(--dark-secondary);
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 90;
        }

        .settings-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .dark-mode .settings-btn {
            background-color: var(--dark-primary);
        }

        .settings-btn:hover {
            transform: scale(1.1) rotate(15deg);
        }

        .settings-btn i {
            font-size: 1.2rem;
        }

        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--accent-color);
            color: #333;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 90;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            transform: translateY(-5px);
        }

        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        .dark-mode .spinner {
            border-top-color: var(--dark-secondary);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .arabic-text {
                font-size: 1.5rem;
                line-height: 2.2;
            }
            
            .container {
                padding: 15px;
            }
            
            .surah-header {
                padding: 15px;
            }
            
            .verse-container {
                padding: 15px;
            }
            
            .app-title {
                font-size: 1.3rem;
            }
            
            .surah-name {
                font-size: 1.7rem;
            }
        }

        @media (max-width: 480px) {
            body {
                font-size: 16px;
            }
            
            .arabic-text {
                font-size: 1.3rem;
                line-height: 2;
            }
            
            .verse-actions {
                flex-direction: column;
            }
            
            .nav-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="header-content">
            <button class="nav-btn" onclick="navigateSurah(+1)">
                <i class="fas fa-arrow-right"></i>
            </button>
            <h1 class="app-title">القرآن الكريم</h1>
            <button class="nav-btn" onclick="navigateSurah(-1)">
                <i class="fas fa-arrow-left"></i>
            </button>
        </div>
    </header>

    <div class="container">
        <div id="surah-header" class="surah-header" style="display: none;">
            <h2 id="surah-name" class="surah-name"></h2>
            <div id="surah-info" class="surah-info"></div>
        </div>

        <div id="bismillah" class="arabic-text" style="text-align: center; display: none;"></div>

        <div id="content">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>

        <div class="nav-controls">
            <button class="nav-btn" onclick="navigateSurah(+1)">
                <i class="fas fa-arrow-right"></i> السورة التالية
            </button>
            <button class="nav-btn" onclick="navigateSurah(-1)">
                <i class="fas fa-arrow-left"></i> السورة السابقة
            </button>
        </div>
    </div>

    <div class="settings-panel">
        <button class="settings-btn" onclick="toggleTheme()" title="تبديل المظهر">
            <i class="fas fa-moon"></i>
        </button>
        <button class="settings-btn" onclick="changeTextSize(1)" title="تكبير الخط">
            <i class="fas fa-plus"></i>
        </button>
        <button class="settings-btn" onclick="changeTextSize(-1)" title="تصغير الخط">
            <i class="fas fa-minus"></i>
        </button>
        <button class="settings-btn" onclick="navigateToWordToWord()" title="كلمة بكلمة">
            <i class="fas fa-fire"></i>
        </button>
        <button class="settings-btn" onclick="navigateToRead()" title="وضع القراءة">
            <i class="fas fa-book-open"></i>
        </button>
    </div>

    <button class="back-to-top" onclick="scrollToTop()" title="العودة للأعلى">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize settings
            const darkMode = localStorage.getItem('darkMode') === 'true';
            const textSize = localStorage.getItem('textSize') || '18';
            
            if (darkMode) {
                document.body.classList.add('dark-mode');
                document.querySelector('.fa-moon').classList.replace('fa-moon', 'fa-sun');
            }

            document.body.style.fontSize = textSize + 'px';

            // Load surah
            const index = getQueryParam('index');
            fetchSurah(index ? index : 1);

            // Show back to top button when scrolling
            window.addEventListener('scroll', toggleBackToTop);
        });

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        async function fetchSurah(index) {
            try {
                // Show loading state
                document.getElementById('content').innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                `;

                const [arabicRes, translationRes, urduRes] = await Promise.all([
                    fetch(`https://raw.githubusercontent.com/itzfew/Quran-Online/refs/heads/main/source/surah/surah_${String(index).padStart(1, '0')}.json`),
                    fetch(`https://raw.githubusercontent.com/itzfew/Quran-Online/refs/heads/main/source/translation/en/en_translation_${String(index).padStart(1, '0')}.json`),
                    fetch(`https://raw.githubusercontent.com/itzfew/Quran-Online/refs/heads/main/source/translation/ur/t_surah_${String(index).padStart(3, '0')}.json`)
                ]);

                const [arabicData, translationData, urduData] = await Promise.all([
                    arabicRes.json(),
                    translationRes.json(),
                    urduRes.json()
                ]);

                displaySurah(arabicData, translationData, urduData);
            } catch (error) {
                console.error('Error loading surah:', error);
                document.getElementById('content').innerHTML = `
                    <div class="verse-container" style="text-align: center; color: red;">
                        <p>حدث خطأ أثناء تحميل السورة. يرجى المحاولة مرة أخرى.</p>
                        <button class="action-btn" onclick="window.location.reload()">إعادة المحاولة</button>
                    </div>
                `;
            }
        }

        function displaySurah(arabicData, translationData, urduData) {
            const surahHeader = document.getElementById('surah-header');
            const surahName = document.getElementById('surah-name');
            const surahInfo = document.getElementById('surah-info');
            const bismillah = document.getElementById('bismillah');
            const content = document.getElementById('content');
            const count = arabicData.count;
            const arabicVerses = arabicData.verse;
            const translationVerses = translationData.verse;
            const urduVerses = urduData.data;

            // Update surah info
            surahHeader.style.display = 'block';
            surahName.textContent = arabicData.name;
            surahInfo.innerHTML = `
                <span>آيات: ${count}</span>
                <span>${arabicData.type === 'meccan' ? 'مكية' : 'مدنية'}</span>
            `;

            // Show Bismillah if not Surah 9 (At-Tawbah)
            if (arabicData.index !== 9) {
                bismillah.style.display = 'block';
                bismillah.textContent = arabicVerses['verse_0'];
            } else {
                bismillah.style.display = 'none';
            }

            // Build verses
            content.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                const arabicVerse = arabicVerses[`verse_${i}`];
                const translatedVerse = translationVerses[`verse_${i}`];
                const urduVerse = urduVerses.find(v => v.aya == i.toString())?.text || '';

                const verseDiv = document.createElement('div');
                verseDiv.className = 'verse-container';
                verseDiv.id = `verse-${i}`;
                verseDiv.innerHTML = `
                    <div class="arabic-text">
                        ${arabicVerse}
                        <span class="verse-number">${i}</span>
                    </div>
                    <div class="translation-text">${translatedVerse}</div>
                    <div class="urdu-text">${urduVerse}</div>
                    <div class="verse-actions">
                        <button class="action-btn share-btn" onclick="shareVerse(${i}, event)">
                            <i class="fas fa-share-alt"></i> مشاركة
                        </button>
                        <button class="action-btn view-btn" onclick="viewVerse(${i})">
                            <i class="fas fa-eye"></i> عرض الآية
                        </button>
                    </div>
                `;

                verseDiv.addEventListener('click', () => toggleHighlight(i));
                content.appendChild(verseDiv);
            }

            // Update current surah index
            currentSurahIndex = parseInt(arabicData.index);
        }

        function toggleHighlight(verseId) {
            const allVerses = document.querySelectorAll('.verse-container');
            allVerses.forEach(verse => verse.classList.remove('selected'));
            
            const verseElement = document.getElementById(`verse-${verseId}`);
            verseElement.classList.add('selected');
            
            // Scroll to the verse with some offset
            const offset = 100;
            const elementPosition = verseElement.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset - offset;
            
            window.scrollTo({
                top: offsetPosition,
                behavior: 'smooth'
            });
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleBackToTop() {
            const backToTopBtn = document.querySelector('.back-to-top');
            if (window.pageYOffset > 300) {
                backToTopBtn.classList.add('visible');
            } else {
                backToTopBtn.classList.remove('visible');
            }
        }

        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDark);
            
            const icon = document.querySelector('.fa-moon, .fa-sun');
            if (isDark) {
                icon.classList.replace('fa-moon', 'fa-sun');
            } else {
                icon.classList.replace('fa-sun', 'fa-moon');
            }
        }

        function changeTextSize(increment) {
            const currentSize = parseInt(document.body.style.fontSize || '18');
            const newSize = Math.max(14, Math.min(24, currentSize + increment));
            document.body.style.fontSize = newSize + 'px';
            localStorage.setItem('textSize', newSize);
        }

        let currentSurahIndex = 1;

        function navigateSurah(direction) {
            currentSurahIndex += direction;

            // Keep within bounds (1-114)
            currentSurahIndex = Math.max(1, Math.min(114, currentSurahIndex));

            // Update URL without reload if supported
            if (history.pushState) {
                const newUrl = `${window.location.pathname}?index=${currentSurahIndex}`;
                history.pushState({ path: newUrl }, '', newUrl);
            }
            
            fetchSurah(currentSurahIndex);
            scrollToTop();
        }

        function shareVerse(verseId, event) {
            event.stopPropagation(); // Prevent triggering the verse click
            
            const verseElement = document.getElementById(`verse-${verseId}`);
            const arabicText = verseElement.querySelector('.arabic-text').textContent.trim();
            const translationText = verseElement.querySelector('.translation-text').textContent.trim();
            
            const shareText = `${arabicText}\n\n${translationText}\n\n- Quran ${currentSurahIndex}:${verseId}`;
            
            if (navigator.share) {
                navigator.share({
                    title: `Quran ${currentSurahIndex}:${verseId}`,
                    text: shareText,
                    url: window.location.href
                }).catch(err => console.log('Error sharing:', err));
            } else {
                // Fallback for browsers without Web Share API
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('تم نسخ الآية إلى الحافظة');
                }).catch(err => {
                    console.log('Error copying:', err);
                    prompt('انسخ النص التالي:', shareText);
                });
            }
        }

        function viewVerse(verseId) {
            window.location.href = `verse.html?surah=${currentSurahIndex}&verse=${verseId}`;
        }

        function navigateToWordToWord() {
            window.location.href = `wordtoword.html?index=${currentSurahIndex}#1`;
        }

        function navigateToRead() {
            window.location.href = `read?index=${currentSurahIndex}/1`;
        }

        // Handle popstate events (back/forward navigation)
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.path) {
                const index = new URL(event.state.path, window.location.origin).searchParams.get('index');
                if (index) fetchSurah(index);
            }
        });
    </script>
</body>
</html>
